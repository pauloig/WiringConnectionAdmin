{% extends 'index.html' %} 
{%load static%}
{% block title %} payroll{% endblock %} 

{% block container %}

<div class="container">
    <form method='post' enctype="multipart/form-data">
        {% csrf_token %}

        <div class="row">
            <div class="col-sm-2" style = "margin: 0px !important; padding: 0px !important;">
                <div class="card">
                    <h6 class="card-header card-header-wc" >Period {{period.periodID}}  -  {{location.name}}</h6>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-5 px-1"><strong>From</strong></div>
                            <div class="col-sm-7 px-1">{{period.fromDate}}</div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5 px-1"><strong>To</strong></div>
                            <div class="col-sm-7 px-1">{{period.toDate}}</div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5 px-1"><strong>Pay Date</strong></div>
                            <div class="col-sm-7 px-1">{{period.payDate  }}</div>
                        </div>
                        <div class="row">
                            <div class="col-sm-5 px-1"><strong>Weeks</strong></div>
                            <div class="col-sm-7 px-1">{{period.weekRange}}</div>
                        </div>
                    </div>
                </div>
                 
            </div>    
            <div class="col-sm-5">
                <div class="card">
                    <h6 class="card-header card-header-wc" >Week 1</h6>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12">
                                {% for item in week1 %}                                                                        
                                    {% if item.selected %}
                                        <a class="btn btn-success position-relative px-2 mx-3 my-2" style="text-align:start !important;" href="/payroll/{{period.id}}/{{item.day}}/0/{{selectedLocation}}"> 
                                            {{item.shortDate}}                                            
                                        </a> 
                                    {%else%}
                                        <a class="btn btn-primary position-relative px-2 mx-3 my-2" style="text-align:start !important;" href="/payroll/{{period.id}}/{{item.day}}/0/{{selectedLocation}}"> 
                                            {{item.shortDate}}
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success" style="font-size:0.7rem;">
                                            {{item.Total}}                                            
                                            </span>
                                        </a> 
                                    {% endif %}                                       
                                {% endfor %}  
                                <input class="form-control" type="text" placeholder="day Selected" aria-label="day Selected" id="daySelected" style="display: none">                             
                            </div>
                        </div>
                                     
                    </div> 
                </div>
            </div>     
            <div class="col-sm-5">
                <div class="card">
                    <h6 class="card-header card-header-wc" >Week 2</h6>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12">                               
                                {% for item in week2 %}                                 
                                    
                                    {% if item.selected %}
                                        <a class="btn btn-success position-relative px-2 mx-3 my-2" style="text-align:start !important;" href="/payroll/{{period.id}}/{{item.day}}/0/{{selectedLocation}}"> 
                                            {{item.shortDate}}                                            
                                        </a> 
                                    {%else%}
                                        <a class="btn btn-primary position-relative px-2 mx-3 my-2" style="text-align:start !important;" href="/payroll/{{period.id}}/{{item.day}}/0/{{selectedLocation}}"> 
                                            {{item.shortDate}}
                                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success" style="font-size:0.7rem;">
                                            {{item.Total}}                                            
                                            </span>
                                        </a> 
                                    {% endif %}                                       
                                {% endfor %}  
                            </div>
                        </div>
                                     
                    </div> 
                </div>
            </div>            
        </div>         
        <div class="row py-2">
            <div class="col-sm-12">   
                {%if selectedDay > 0 %}      
                    <a class="btn btn-success px-2" href="/create_daily/{{period.id}}/{{selectedDay}}/{{selectedLocation}}">
                        Add Crew
                    </a> 
                {%endif%}
                    
                {% for item in crew %}                         
                    {% if item.crew == selectedCrew %}
                        <a class="btn btn-warning px-2" href="/payroll/{{period.id}}/{{item.day|date:'d'}}/{{item.crew}}/{{selectedLocation}}" role="button">Crew {{item.crew}}</a>
                    {%else%}
                        <a class="btn btn-info px-2" href="/payroll/{{period.id}}/{{item.day|date:'d'}}/{{item.crew}}/{{selectedLocation}}" role="button">Crew {{item.crew}}</a>
                    {%endif%} 
                {%endfor%}
                  
                               
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 px-1">
                <div class="card">
                    <h6 class="card-header card-header-wc text-center"> {{selectedDate}} </h6>
                    <div class="card-body">
                        {% for item in crew %} 
                            {% if item.crew == selectedCrew %}
                                <div class="row">                            
                                    <div class="col-sm-3">      
                                        <div class="mb-3">
                                            <label for="supervisor" class="form-label">Supervisor</label>
                                            <select class="form-select" name="supervisor" id="supervisor">
                                                <option value ="0" selected>Select Supervisor</option>
                                                {% for sup in superV %}    
                                                    {% if sup.employeeID|slugify == item.supervisor %}                                                 
                                                        <option value="{{sup.employeeID}}" selected>{{sup.first_name}} {{sup.last_name}}</option>  
                                                    {% else %}     
                                                        <option value="{{sup.employeeID}}">{{sup.first_name}} {{sup.last_name}}</option>   
                                                    {%endif%}            
                                                {% endfor %}      
                                            </select>        
                                        </div>                                                                                  
                                                                                        
                                    </div>  
                                    <div class="col-sm-4">
                                        <div class="mb-3">    
                                            <label for="PID" class="form-label">PID - Work Order - PO</label>                
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" placeholder="Enter PID" aria-label="PID" id="PID" name="PID" aria-describedby="basic-addon1" value="{{item.woID.prismID}} - {{item.woID.workOrderId}} - {{item.woID.PO}}" disabled>                                             
                                                <button hx-get="/orders_payroll/{{item.id}}" class="btn btn-primary py-2" hx-target="#dialog" ><i class="fa-sharp fa-solid fa-magnifying-glass"></i></button>
                                            </div>                                      
                                        </div>        
                                    </div>                                  
                                    <div class="col-sm-5">
                                        <div class="mb-3">
                                            <label for="PID" class="form-label">Address</label>
                                            <input type="text" class="form-control" placeholder="Address" aria-label="address" aria-describedby="address_l" value="{{item.woID.JobAddress}}" disabled>                                    
                                        </div>     
                                    </div>
                                </div>
                                </br>     
                                <div class="row">                                      
                                    <div class="col-sm-2">
                                        <div>
                                            <label class="form-label" for="">dist. payment</label>
                                        </div>
                                        <div class="form-check">
                                            {% if item.split_paymet %}
                                                <input class="form-check-input" type="checkbox" value="True" id="split" name="split" checked>
                                            {% else %}
                                                <input class="form-check-input" type="checkbox" value="False" id="splpit" name="split">
                                            {%endif%}
                                            <label class="form-check-label" for="flexCheckDefault">
                                              Split
                                            </label>
                                          </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <div class="mb-3">
                                            <label class="form-label" id="ptp_l">Total % to pay</label> 
                                            <input type="input" class="form-control" placeholder="% to pay" id="ptp" name="ptp" aria-label="ptp" aria-describedby="ptp_l" value="{%if item.total_pay > 0 %}{{item.total_pay}}{%endif%}" min="0" max="100" disabled>                                  
                                        </div> 
                                    </div>
                                    <div class="col-sm-2">
                                        <div class="mb-3">
                                            <label class="form-label" id="ov_l">% own Vehicle</label> 
                                            <input type="input" class="form-control" placeholder="% own Vehicle" id="ov" name="ov" aria-label="ov" aria-describedby="ov_l" value="{%if item.own_vehicle > 0 %}{{item.own_vehicle}}{%endif%}" min="0" max="100">                                  
                                        </div> 
                                    </div>
                                    <div class="col-sm-2 pt-4">
                                        <input type="text" class="form-control d-none" id="daily" name="daily" value="{{item.id}}">   
                                        <!--<button href="/payroll/{{period.id}}/{{selectedDay}}/{{selectedCrew}}/{{item.id}}" class="btn btn-success px-3" type="submit">update</button>--> 
                                        <button class="btn btn-success px-3" type="submit">update</button>                               
                                    </div> 
                                </form>
                                    <div class="col-sm-4 pt-3">
                                        <button type="button" class="btn btn-primary p-3" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                            upload daily
                                        </button> 
                                        {% if item.pdfDaily != '' and item.pdfDaily != None %}                                        
                                            <a class="btn btn-primary p-3" href="/static/media/{{item.pdfDaily}}" target="_blank"> View Daily</a>  
                                        {% endif %}  
                                        <!--<a class="btn btn-secondary p-3" hx-get="/upload_daily/{{item.id}}" hx-target="#dialog">Upload Daily  <i class="fa-solid fa-user-plus"></i></a></td>
                                         <a class="btn btn-secondary p-3" hx-get="/create_daily_emp/{{item.id}}" hx-target="#dialog">SUmmary   <i class="fa-solid fa-user-plus"></i></a></td>-->
                                    </div>
                                </div>   
                                <div class="row">
                                    <div class="col-sm-12">
                                        {%if item.total_pay != 100 %}
                                            <h4 style="color:red;"> The Total % to Pay must be equal to 100</h4>
                                        {%endif%}
                                        {% if item.supervisor == None or item.woID == None %}
                                            <h4 style="color:orangered;">You must select supervisor and PID to be able to add employees and production in this crew</h4>
                                        {%endif%}
                                    </div>
                                </div>
                                <div class="row">                           
                                    <div class="col-sm-8 px-1">
                                        <div class="card">
                                            <h6 class="card-header card-header-wc" >Employee List</h6>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-sm-12 px-1">
                                                        <table class="table table-sm table-bordered table-striped">
                                                            <thead>
                                                                <tr class="table-primary">                                                  
                                                                    <td width="25%" class="p-1">Name</td>
                                                                    <td width="8%" class="p-1">% Pay</td>
                                                                    <td width="8%" class="p-1">On Call</td>
                                                                    <td width="8%" class="p-1">Bonus</td>                                     
                                                                    <td width="10%" class="p-1">Total Hrs</td>
                                                                    <td width="9%" class="p-1">Reg Hrs</td>
                                                                    <td width="8%" class="p-1">OT Hrs</td>
                                                                    <td width="8%" class="p-1">DT Hrs</td>
                                                                    <td width="8%" class="p-1">Payout</td>
                                                                    <td width="8%" class="p-1">
                                                                        {% if item.supervisor != None and item.woID != None %}
                                                                            <a hx-get="/create_daily_emp/{{item.id}}" hx-target="#dialog"><i class="fa-solid fa-user-plus"></i></a>
                                                                        {% endif %}
                                                                    </td>
        
                                                                    
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {%for emp in dailyEmp %}
                                                                    <tr>                                                       
                                                                        <td class="p-1">{{emp.EmployeeID}} </td>
                                                                        <td class="p-1">{{emp.per_to_pay|floatformat:"2"}}%</td>
                                                                        <td class="p-1">{%if emp.on_call > 0 %}${{emp.on_call}}{%else%}$0.00{%endif%}</td>
                                                                        <td class="p-1">{%if emp.bonus > 0 %}${{emp.bonus}}{%else%}$0.00{%endif%}</td>
                                                                        <td class="p-1">{{emp.total_hours}}</td>
                                                                        <td class="p-1">{{emp.regular_hours}}</td>
                                                                        <td class="p-1">{{emp.ot_hour}}</td>
                                                                        <td class="p-1">{{emp.double_time}}</td>
                                                                        <td class="p-1" style="color: red;">{%if emp.payout > 0 %}${{emp.payout|floatformat:"2"}}{%else%}$0.00{%endif%}</td>
                                                                        <td class="p-1">
                                                                            <a hx-get="/update_daily_emp/{{emp.id}}" hx-target="#dialog"><i class="fa-solid fa-user-pen" style="color: green;"></i></a>
                                                                            <a hx-get="/delete_daily_emp/{{emp.id}}" hx-target="#dialog">  <i class="fa-solid fa-user-minus" style="color: red;"></i></a>
                                                                        </td>                                                        
                                                                    </tr>
                                                                {%endfor%}
                                                            </tbody>                                                
                                                        </table>
                                                    </div>
                                                </div>                                                
                                            </div>
                                        </div>    
                                    </div>
                                    <div class="col-sm-4 px-1">
                                        <div class="card">
                                            <h6 class="card-header card-header-wc" >ITEM LIST  -     TOTAL: ${{TotalItem}} + ${{ovTotal}} = ${{GranTotalItem}} </h6>
                                            
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-sm-12 px-1">
                                                        <table  class="table table-sm table-bordered table-striped">
                                                            <thead>
                                                                <tr class="table-primary">                                                    
                                                                    <td width="20%" class="p-1">Item</td>
                                                                    <td width="20%" class="p-1">Qty.</td>
                                                                    <td width="20%" class="p-1">Price</td>
                                                                    <td width="20%" class="p-1">Total</td>  
                                                                    <td width="20%" class="p-1">
                                                                        {% if item.supervisor != None and item.woID != None %}
                                                                            <a hx-get="/create_daily_item/{{item.id}}" hx-target="#dialog"><i class="fa-solid fa-circle-plus"></i></a>
                                                                        {% endif %}
                                                                    </td>                                                 
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                {%for itemd in dailyItem %}
                                                                    <tr>
                                                                        <td class="p-1">{{itemd.itemID.item.itemID}}</td>
                                                                        <td class="p-1">{{itemd.quantity}}</td>
                                                                        <td class="p-1">${{itemd.itemID.emp_payout}}</td>
                                                                        <td class="p-1">${{itemd.total}}</td>   
                                                                        <td class="p-1">
                                                                            <a hx-get="/update_daily_item/{{itemd.id}}" hx-target="#dialog"><i class="fa-solid fa-pen-to-square" style="color: green;"></i></a>
                                                                            <a hx-get="/delete_daily_item/{{itemd.id}}" hx-target="#dialog"><i class="fa-solid fa-circle-minus" style="color: red;"></i></a>
                                                                        </td> 
                                                                    </tr>
                                                                {%endfor%}
                                                            </tbody>                                                
                                                        </table>
                                                    </div>
                                                </div>                                                
                                            </div>
                                        </div>  
                                        
                                    </div>                                                           
                                </div>  
                                <!-- Modal -->
                                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                                    <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                        <h5 class="modal-title" id="staticBackdropLabel">Modal title</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <form method='post'  action="/upload_daily/{{item.id}}" enctype="multipart/form-data" id="daily_upload" >
                                                {% csrf_token %}                                                                                                                                                                      
                                                <label class="form-label" for="file">Select File</label>                                    
                                                <div class="input-group-btn">
                                                    <div class="input-group mb-3">
                                                        <input type="file" class="form-control" id="myfile" name="myfile" accept=".pdf" required>                                                                                                            
                                                        <!--<button type="submit" class="btn btn-primary" form="daily_upload">Save</button>-->
                                                    </div>                                                    
                                                </div>                                                                                      
                                            </form>
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" form="daily_upload" class="btn btn-primary">Upload</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>                 
                            {%endif%} 
                        {%endfor%}
                       
                        
                                           
                    </div>
                </div>                 
            </div>    
        </div>
        


    
</div>

<script src="https://unpkg.com/htmx.org@1.8.4"></script>

{% endblock %}